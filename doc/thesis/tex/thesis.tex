\documentclass[a4paper, 12pt]{article}
\title{Aproximácia wattového vıkonu športovca}
\author{Matúš Maèák}
\usepackage[slovak]{babel} %language
\usepackage[cp1250]{inputenc} %encoding
\usepackage[pdftex]{graphicx}
\usepackage{eurosym} %euro symbol

\usepackage{indentfirst} %paragraph indent
\setlength{\parindent}{0.5in}

\usepackage{enumitem} %itemize
\usepackage{tikz} % plus minus symbol

\usepackage{mathtools} %math formulas
\usepackage{amsmath} 

\usepackage[toc,page]{appendix}

\usepackage[left=3.5cm,top=2.5cm,bottom=2.5cm,right=2cm]{geometry}%page margin

\usepackage{float} %images positionning
\usepackage{fancyvrb}%formating pieces of code

\usepackage{fancyhdr} %headers
\pagestyle{fancy}

\usepackage{textcomp} %angular brackets

\linespread{1.4} %line spacing
% B E G I N   OF   D O C U M E N T
\begin{document}
\thispagestyle{empty} % hide page number
\setcounter{page}{1} %start of numbering
\section*{Prehlásenie autora}
\vspace{10mm}
Èestne prehlasujem, e táto diplomová práca je mojim pôvodnım autorskım dielom, na ktorom som pracoval samostatne na základe vlastnıch teoretickıch a praktickıch poznatkov získanıch poèas štúdia a informácií z dostupnej literatúry. Všetky zdroje, literatúru a pramene, ktoré som pri vypracovaní pouil, riadne citujem s uvedením plného odkazu na príslušnı zdroj. Uvedenú prácu som vypracoval pod vedením Ing. Stanislava Marèeka.\\
\vspace{10mm}

\begin{table}[H]
  \centering
  \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}} c} % l r text align left right 
    Bratislava, dòa 21. 05. 2015 & \\
    & . . . . . . . . . . . . . . . . . . . .  \\
    & Bc. Matúš Maèák\\
  \end{tabular*}
\end{table}

\newpage

\thispagestyle{empty}
\section*{Poïakovanie}
\vspace{10mm}
Ïakujem rodine, priate¾ke Anne a môjmu trénerovi, Mgr. Patrikovi Kurilovi, ktorı ma o tréningu nauèil všetko, èo som mohol vyui pri návrhu algoritmu.

\newpage
\thispagestyle{empty}
\section*{Abstrakt}
\noindent Univerzita: Slovenská technická univerzita v Bratislave\\
Fakulta: Fakulta elektrotechniky a informatiky\\
Študijnı program: Aplikovaná informatika\\
Školiace pracovisko: Ústav informatiky a matematiky\\
Autor: Bc. Matúš Maèák\\
Názov práce: Aproximácia wattového vıkonu športovca\\
Vedúci práce: Ing. Stanislav Marèek\\
Bratislava 2015
\\\\
\indent Diplomová práca sa zaoberá h¾adaním algoritmu pre odhadnutie wattového vıkonu športovca, cyklistu. V úvode práce je vysvetlená dôleitos sledovania vıkonu ako hlavného ukazovate¾a v tréningu. Popisuje zariadenia, aplikácie a štandardy, ktoré sú vyvinuté za úèelom sledovania tréningovıch údajov. Jadro práce pojednáva o problematike odhadovania vıkonu z rôznych údajov a prezentuje riešenie, ktoré umoòuje urèi pribliné hodnoty vıkonu bez jeho priameho merania. Záver práce je venovanı rozboru a analıze presnosti údajov odhadnutıch algoritmom.
\\\\   
\indent K¾úèové slová: šport, cyklistika, vıkon, ANT+

\newpage
\thispagestyle{empty}
\section*{Abstract}
\noindent University: Slovak Technical University in Bratislava\\
Faculty: Faculty of Electrical Engineering and Information Technology\\
Study programme: Applied Informatics\\
Training workplace: Institute of Computer Science and Mathematics\\
Author: Matúš Maèák\\
Title: Approximation of athlete power output\\
Thesis supervisor: Ing. Stanislav Marèek\\
Bratislava 2015
\\\\
\indent This master thesis describes the research of algorithm for estimating the power effort of an athlete, cyclist. First part explains the importance of monitoring the power as the main indicator in training. It describes devices, software and standards that are developed to track sport activity. The main part deals with common problems in power estimation from various data and presents the solution that allows approximating the value of athlete's power without a direct measurement. The conclusion is devoted to review and analyze the accuracy of the algorithm.
\\\\
\indent Keywords: sport, cycling, power, ANT+

\newpage 
\thispagestyle{empty}
\tableofcontents %table of contents

\newpage
\thispagestyle{empty} %my fancy header
\listoffigures

\newpage
\addtocounter{section}{-1}
\section{Úvod}
Technologickı pokrok je bezpochyby dôvodom, preèo sa rôzne inteligentné zariadenia stávajú naším najdôleitejším nástrojom pri kadodennej rutine, ale aj v krízovıch situáciách. Inak tomu nie je ani v športe, najmä ak sa jedná o vytrvalostné disciplíny. Na pulte takmer kadej športovej predajne sú k dispozícii meraèe srdcového tepu, športové hodinky, cyklopoèítaèe s GPS a podobne. Nielen tréning pod¾a vlastného pocitu, ale podriadenie tréningovej záae údajom na meracom zariadení sa stáva k¾úèom k postupnému zvyšovaniu vıkonnosti. Vysoká dostupnos technológií a \emph{know-how} vyrovnáva schopnosti konkurencie. Víazia športové drustvá, ktoré okrem mimoriadneho talentu dokáu tréning najlepšie zmera, vyhodnoti a opätovne naplánova.\\
\indent V práci sa zameriavame na analızu vytrvalostného športu - cyklistiky, ktorú môeme v globále urobi z údajov ako je dåka tréningu v hodinách, tzv. tréningovı objem, vzdialenos, rıchlos, tepová frekvencia. Tréning pod¾a tepovej frekvencie môe by pre športovca obrovskım prínosom za predpokladu, e má správne stanovené tréningové zóny, ktoré by mali odzrkad¾ova zaaenie organizmu \cite{kontrolovany_trening}. Tepovú frekvenciu u môeme v dnešnej dobe povaova za pomerne nenákladnı spôsob usmernenia tréningu, no má však jednu nevıhodu. Tep srdca reaguje na stúpajúce zaaenie s miernım oneskorením a môe by skreslenı pri vıkyve vnútornej rovnováhy organizmu. V cyklistike, kde na reálny vıkon, vyjadrite¾nı fyzikálnou velièinou, vplıva ve¾ké mnostvo faktorov, je aktuálna rıchlos síce okamitım, ale ve¾mi nepresnım ukazovate¾om. Preto je meraè rıchlosti aj tepovej frekvencie postupne nahrádzanı meraèom vıkonu.\\
\indent Meranie vıkonu v cyklistike nám poskytuje okamitú odpoveï na otázky: ako ve¾mi sa športovec namáha, akou silou pôsobí na pedále. Subjektívny pocit námahy nahrádza konkrétny èíselnı údaj, štandardne vyjadrenı v jednotkách \emph{Watt [W]}. Problémom je však cenová dostupnos takéhoto merania. U profesionálnych športovcov mono cenová nároènos nehrá rolu, avšak sú aj športoví nadšenci, amatérski pretekári, ktorí si chcú zmera svoj progres, prípadne sa porovna s najlepšími. Vıkon je miera toho ako rıchlo vykonáva urèitá sila prácu \cite{obecna_fyzika}. Je to fyzikálna velièina, a teda by malo by by moné ho vypoèíta na základe údajov ako je stúpanie, rıchlos, vzdialenos. Práve tımto vıpoètom sa snaíme odhadnú vıkon športovca.

\newpage
\section{Analıza problému}
\subsection{Vıznam velièiny vıkon v tréningu cyklistu}
Ako sme spomenuli v úvode, obrovská dostupnos informácií a prostriedkov umoòuje vykonáva kontrolovanı tréning takmer kadému záujemcovi. Pokia¾ máme záujem o perspektívne zlepšovanie, prvım krokom by malo by absolvovanie vıkonnostného testu u športového lekára, tzv. funkèného testu. Lekár by na základe anamnézy, predchádzajúcich skúseností so športom a aktuálnej vıkonnosti mal odporuèi primerané tréningové zaaenie. Èo je však najdôleitejšie, mal by stanovi aj tréningové zóny, v ktorıch by sa športovec pri tréningu mal pohybova a v akom trvaní, teda odporuèi tréningovı plán \cite{kontrolovany_trening}. Tréning cyklistu nemôe by postavenı iba na odjazdení urèitej vzdialenosti v èo najkratšom èase, a ani trénovaní vytrvalosti tım, e sa trénuje èo najdlhšie. Tréning cyklistu je zloenı z rôznych intenzít, úsekov, opakovaní a cvièení, kedy sa trénujúci športovec vedome pohybuje v urèite tréningovej zóne aby docielil ideálny tréningovı impulz.\\
\indent Zámerne pouívame slovné spojenie tréningová zóna a nielen tepová zóna, hoci sa tieto slovné spojenia èasto zamieòajú. Tréningová zóna je však úroveò fyzického zaaenia, ktoré priebieha v ¾udskom organizme. Najjednoduchšie odporúèané delenie je: 
\begin{itemize}
 \item Aeróbne pásmo 
 \item Zmiešané pásmo 
 \item Anaeróbny prah 
 \item Anaeróbne pásmo
\end{itemize}
Ako sú tréningové zóny kontrolované poèas tréningu je len na samotnıch monostiach športovca. Najideálnejším ukazovate¾om by bola hladinu laktátu v krvi. Túto metódu však do kadodenného tréningu aplikova nemôeme, nako¾ko odber krvi z prsta alebo ucha a následné vyhodnotenie vzorky je zdåhavé. Najdostupnejšia je metóda merania tepovej frekvencie, ktorá však nie je vdy spo¾ahlivá.\\
\indent Kadı ¾udskı organizmus je unikátny komplexnı biologickı systém. Tlak krvi, hormonálna rovnováha, krvnı obraz a iné faktory neustále ovplyvòujú tep srdca. Mierny rozdiel v tepovej frekvencii pri rovnakej záai môeme pozorova u pri porovnaní tréningu ráno a veèer. Pred prichádzajúcim ochorením môeme zaznamena zvıšenie tepovej frekvencie. Niší tep športovci vykazujú po nieko¾kıch dòoch nároèného tréningu. Taktie sme sa stretli s prípadmi, keï subjektívny pocit športovca bola únava a oproti normálu mal mierne zníenú tepovú frekvenciu, ale jeho wattovı vıkon v nároènom tréningu bol porovnate¾nı, niekedy aj lepší ako v iné dni. Vyšší tep sa dá jasne pozorova u pri ve¾mi miernej dehydratácii, napr. na konci dlhého tréningu v teplom poèasí. Sledovanie faktorov, ktoré ovplyvòujú tepovú frekvenciu nie je predmetom tejto práce. Je však dôleité poznamena, e z poh¾adu finaènej nároènosti a vıpovednej hodnoty je tepová frekvencia stále ve¾mi dobrım kontrolnım mechanizmom pre riadenie tréningu. \\
\indent Okamité hodnoty, ktoré reprezentujú zaaenie organizmu a ve¾mi dobrú presnos, získame meraním vıkonu. Môeme urèi intenzitu pri krátkych zrıchlenıch úsekoch, kedy tepová frekvencia ešte nestihne vystúpi na hodnotu zodpovedajúcu fyzickému zaaeniu. Môeme presnejšie analyzova podanı vıkon pri dlhších úsekoch v maximálnom úsilí, kedy zrıchlenie/spomalenie môe odzrkad¾ova zmena tepová frekvencia o 1 tep, ale rozdiel vo vıkone môe by aj o 10\%. Obr. \ref{fig:bpm_watt_comparsion} zobrazuje, ako sa môe meni vıkon športovca v porovnaní s tepovou frekvenciou.
\begin{figure}[H]
\centering
\includegraphics[scale=0.65]{images/bpm_watt_comparsion.png}
\caption{Porovnanie vıkonu a tepovej frekvencie pri záai}
\label{fig:bpm_watt_comparsion}
\end{figure}
Z priebehu kriviek môeme pozorova, ako odpoèinutı športovec absolvuje úsek v tréningu. Poèas desiatich minút mal udriava vıkon vyšší ako 340 W. Vidíme, e na stúpajúce záaenie telo reaguje zvıšením tepovej frekvencie, zároveò sa v zaaovanıch svaloch tvorí kyselina mlieèna (laktát). Prvıch pä minút športovec absolvoval s priemernım vıkonom 410W. Po zahltení svalov laktátom a ustálení tepovej frekvencie u danı vıkon udriava nedokázal a postupne záa zvo¾òuje na priemernıch 320W. Kım tepová frekvencia kolíše v rozsahu $\pm$1 tep, priemernı vıkon v druhej polovici je o 20W niší ne poadované zaaenie. Zmena však stále nie je dostatoèná na to, aby mohlo dôjs k èiastoènému zotaveniu svalov, hladina laktátu v krvi je stále vysoká, na èo telo reaguje vysokou tepovou frekvenciou. Hoci po skonèení tréningu má športovec pocit vyèerpanosti, neabsolvoval tréning pod¾a plánovaného konceptu. Zdokonalenie podobnıch chıb môe vies k lepšiemu rozloeniu síl a lepšiemu vystupòovaniu vıkonu, napr. v závere pretekov. Pri analıze vıkonu sú tieto chyby jasne vidite¾né.

\subsection{Štandardy pre prenos tréningovıch dát}
V predchádzajúcich èastiach sme nieko¾kokrát spomenuli športové hodinky alebo cyklopoèítaè. Ich spoloènou funkciou je prijímanie dát z rôznych snímaèov, zobrazenie dát, a tie aj uloenie pre neskoršie vyhodnotenie. Na trhu je ve¾ké mnostvo vırobcov, ktorı uprednosòujú vlastné formy prenosu a formu ukladania dát. Existujú však aj \emph{open-source} protokoly, ktoré umoòujú interoperabilitu medzi zariadeniami rôznych znaèiek, prípadne aj inteligentnımi telefónmi. Vo vıskume sme sa na rozbor problematiky a následné vyhodnotenie presnosti rozhodli pouíva zariadenia na meranie vıkonu PowerTap G3 (rok vıroby 2013), Stages Rival (rok vıroby 2014) a cyklopoèítaè Garmin Edge 500 (rok vıroby 2014). Preto chceme v nasledujúcej èasti popísa štandardy, ktoré tieto zariadenia vyuívajú, a teda sa bezprostredne dotıkajú našej práce.
\subsubsection{GPX}
GPX je rozšírenie formátu XML vytvorené za úèelom štandardizácie prenosu GPS súradníc a trás pre navigaèné systémy. Prvá verzia bola vydaná v roku 2002 a~neskôr aktualizovaná v roku 2004. Neskoršie rozšírenie od firmy Garmin - schéma \emph{GpxExtensions} umoòuje medzi GPS súradníce pridáva body záujmu\footnote{z angl. Points of interest}, meni zobrazenie trasy, a podobne. Neskôr Garmin pridal aj schému \emph{TrackPointExtension}, ktorú u bolo moné vyui aj v zariadeniach, ktoré súvisia so športom. Okrem informácii o trase je moné do súboru uloi aj údaje o tepovej frekvencii, teplote, rıchlosti a ïalšie \cite{thisisant}. 
\subsubsection{TCX}
TCX alebo plnım názvom Training Center XML je dátovı formát predstavenı v roku 2007, opä firmou Garmin ako súèas ich Training Center produktov. Formát XML je ve¾mi podobnı štandardu GPX, avšak postupnos súradníc reprezentuje skôr ako fyzickú aktivitu ne len trasu. Predstavuje štandard prenosu údajov zo športovıch meraèov ako je  tepová frekvencia, kalórie, frekvencia šliapania (bicykel) alebo kroku (beh) a mnohé ïalšie. Tie môe obsahova sumarizované údaje pre celú aktivitu aj~jednotlivé okruhy \cite{thisisant}.
\subsubsection{ANT}
ANT je nízko-energetickı\footnote{z angl. Ultra-low power} bezdrôtovı protokol prenosu dát medzi zariadeniami. Robustnı ale ve¾mi flexibilnı protokol nachádza vyuititie v PAN\footnote{PAN - personal area network} alebo LAN\footnote{LAN - local area network} sieach. Je ideálny pre športové aktivity, fitness a welness.\\
\indent ANT prenos dát prebieha na frekvencii medzi 2400 MHz a 2524 MHz s vınimkou frekvencie 2457 MHz, ktorá je rezervovaná pre ANT+ zariadenia.\\
\indent ANT+ je mnoina definícií, ktoré upresòujú, èo reprezentujú informácie posielané v sieti ANT. Definícia sa nazıva \emph{device profile} a obvykle je vytvorená na základe urèitého prípadu pouitia. Napríklad senzor rıchlosti na bicykli bude odosiela informácie o rıchlosti, preto implementuje profil \emph{Speed monitor}.\\
\indent Kadé ANT+ zariadenie musí pristupova do ANT+ siete so sieovım k¾úèom a implementova minimálne jeden \emph{device profile}. Zariadenie s danım profilom je moné spoji s ïalšími zariadeniami, ktoré implementujú rovnakı profil. Jedno zariadenie môe samozrejme implementova aj viac profilov. Napr. športové hodinky môu prijíma údaje o rıchlosti, tepovej frekvencii, vıkone a pre kadı údaj implementujú samostanı \emph{device profile}.\\
\indent V ANT+ sieti obvykle rozlišujeme dva typy zariadení. Meracie zariadenie, ktoré je pod¾a špecifikácie nazıvané \emph{sensor} a zobrazovacie zariadenie, \emph{display}. ANT+ umoòuje pripojenie jedného, alebo aj viacerıch zariadení typu \emph{sensor} na jedno zariadenie typu \emph{display}. Na jednıch športovıch hodinkách teda môeme zobrazi viacero meranıch velièín, alebo pripoji jedno zariadenie typu \emph{sensor} na viac zariadení typu \emph{display}.
\subsubsection{FIT}
The Flexible and Interoperable Data Transfer (FIT) protokol bol navrhnutı špeciálne pre ukladanie a prenos dát pochádzajúcich zo športovıch aktivít. Definuje nieko¾ko šablón pre ukladanie dát, tzv. \emph{Fit message}. Môu v nich by uloené informácie o pouívate¾skom profile, dáta zo športovej aktivity a podobne. Bol navrhnutı tak aby bol kompaktnı, interoperabilnı a rozšírite¾nı.\\
FIT protokol pozostáva z:
\begin{itemize}
 \item Definície štrukúry .fit súboru
 \item Definície dátovıch polí a dátovıch typov pre jednotlivé \emph{Fit messages}
 \item Vıvojového nástroja, tzv. SDK\footnote{SDK - Software development kit}, ktorı umoòuje vygenerova potrebnı zdrojovı kód pre nakonfigurovanie produktov vyuívajúcich FIT protokol. Obsahuje aj nástroj pre konverziu binárneho .fit súboru do .csv dátového súboru a opaène. 
\end{itemize}
FIT súbor obsahuje dátové reazce, prièom kadı reazec je zostavenı z hlavièky a obsahu. Obsah dátového reazca môe by buï špecifikácia dát v nasledujúcom reazci alebo správa, ktorá obsahuje nieko¾ko polí s údajmi, viï obr. \ref{fig:fit_protocol}. 
\begin{figure}[H]
\centering
\includegraphics[scale=0.65]{images/fit_protocol.png}
\caption{Zjednodušená štruktúra FIT súboru}
\label{fig:fit_protocol}
\end{figure}
Na konverziu bitového FIT súboru vyuijeme konverznı nástroj v jazyku JAVA. Vıstupom konverzie sú dva CSV súbory. Prvı súbor je textovou reprezentáciou dát z FIT súboru, èo znamená, e niektoré riadky sú definíciou nasledujúcich údajov a niektoré riadky nesú údaje. Zároveò je potrebné si všimnú, e údaje nie sú rozdelené fixne pod¾a ståpcov. Ståpec \emph{Field N} oznamuje, èo reprezentuje hodnota v ståpci \emph{Value N}, ståpec \emph{Units N} definuje jednotky pre túto hodnotu, prièom N$>$0. Jeden ståpec \emph{Field N} nemusí nies vdy rovnakı údaj. Príklad uvádzame na obr. \ref{fig:fit_file1}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.6]{images/fit_file1.png}
\caption{CSV súbor po konverzii z FIT}
\label{fig:fit_file1}
\end{figure}
Druhı súbor, ktorı je vıstupom z konverzie má príponou \emph{\_data.csv} a obsahuje všetky dáta usporiadané vo forme ståpcov. Jeden ståpec reprezentuje vdy konkrétny údaj pod¾a hlavièky, napr. \emph{event.timestamp[s]}, \emph{record.altitude[m]}, \emph{record.speed[m/s]}... Jednotky sú uvádzané v hranatej zátvorke v záhlaví ståpca. Oba súbory teda obsahujú všetky dáta, rozdielna je iba ich postupnos. Rozhodli sme sa pouíva prvú spomenutú štruktúru. Najdôleitejšie sú riadky, kde ståpec \emph{Type} nadobúda hodnotu \emph{Data}, v ståpci \emph{Message} sú hodnoty \emph{record} pre jednotlivé body v tréningu, \emph{session} pre sumarizáciu alebo \emph{lap} pre informáciu o stlaèení medzièasu.

\subsection{Meranie vıkonu}
Pre správne pochopenie problematiky sa musíme oboznámi so zauívanım spôsobom merania vıkonu cyklistu. Vıkon je meranı špeciálnym snímaèom, ktorı je vo väèšine prípadoch zabudovanı priamo v komponente bicykla. Jedná sa o komponent, ktorı sa priamo stará o prenos sily  pôsobiacej na pedál do pohonu zadného kolesa. Môe to by náboj zadného kolesa, jedna alebo obe k¾uky stredového zloenia, prípadne pedále. To, kde je snímaè umiestnenı, záleí od konkrétneho vırobcu a jeho techniky merania. Snímaè nazıvame meraè vıkonu\footnote{z angl.: Power Meter}. \\
\indent Najdôleitejším prvkom meraèa je tenzometer. Ide o súèiastku s uzavretnım elektrickım okruhom a konštatnım elektrickım odporom. Ak je tenzometer vystavenı pôsobeniu mechanickej sily, dochádza k jeho deformácii, zmene odporu a vïaka piezolektrickému javu aj k zmene napätia. Správnou konfiguráciou je teda moné zisti presnú silu pôsobiacu na túto súèiastku.\\ 
\indent Ako sme uviedli v predchádzajúcej èasti, vıkon je mierou toho ako rıchlo vykonáva urèitá silu prácu. Vezmime do úvahy jednoduchı vzah: 
\begin{equation} \label{eq:power_trivial1}
P = F\ \cfrac{\partial d}{\partial t}
\end{equation}
Vıkon \emph{P} je rovnı sile, ktorú je potrebné vyvinú, aby sme teleso s urèitou hmotnosou premiestnili po dráhe \emph{d} za èas \emph{t}. Dáta obsiahnuté v súboroch, s ktorımi pracujeme (GPX, TCX, FIT), sú diskrétne hodnoty uloené poèas tréningu v nieko¾ko sekundovıch intervaloch. Vzah \emph{\ref{eq:power_trivial1}} teda môeme upravi, keïe dráha prekonaná za èas predstavuje rıchlos.
\begin{equation} \label{eq:power_trivial2}
P = F\ v 
\end{equation}
To je podstata fungovania meraèa vıkonu vo ve¾mi zjednodušenej forme. Sila zmeraná tenzometrom je odoslaná do cyklopoèítaèa/športovıch hodiniek, tam je násobená aktuálnou rıchlosou a zobrazí sa vıkon v jednotkách \emph{Watt}. Podrobnejšie skúmanie toho, ako konkrétne typy meraèov merajú vıkon a jeho ïalšie fyzikálne vyjadrenie nie je predmetom tejto práce, keïe sa budeme snai odhadova vıkon na základe pohybu vo vonkajšom prostredí. Sily, ktoré pôsobia proti pohybu športovca pri jazde na bicykli blišie rozoberáme v kapitole \ref{Physics}.\\
\indent Prvı meraè vıkonu bol dostupnı verejnosti v roku 1989. Jednalo sa o znaèku SRM (Schoberer Rad Messtechnik), ktorá svoj produkt testovala s profesionálnymi športovcami od zaèiatku osemdesiatych rokov.\cite{cyclingweekly_power}\\
\indent Väèšina vırobcov v súèasnosti uvádza pre svoje meraèe odchılku do 2\%. Moné odchılky môu by spôsobené stratou pri prenose sily z pedálu na pohon zadného kolesa, t.j. napnutím reaze, prunosou rámu, prunosou kolesa, kalibráciou meraèa atï. Je dôleité si uvedomi, e iaden meraè, ktorı je súèasou bicykla, z tıchto dôvodov nebude ukazova presnı vıkon podávanı športovcom. Ak však športovec dlhodobo pouíva rovnakú metódu merania, porovnávanie jeho vıkonov má ve¾kı vıznam.

\subsection{Softvér pre vyhodnotenie tréningu}
\subsubsection{Strava}
Strava je portál, ktorı sa snaí zdruova komunity športovcov po celom svete. Nosnım pilierom Strava je webová aplikácia na adrese \emph{http://www.strava.com}, ktorá ponúka komplexnú analızu tréningovıch dát a mnostvo sociálnych funkcií. Ako uvádza priamo Strava\cite{strava}, pouívate¾ovi umoòuje zai tzv. \emph{social fitness}, èo by malo predstavova spojenie, porovnanie a súaenie s ïalšími športovcami. Okrem webovej aplikácie je moné vyui aj mobilnú aplikáciu pre platformu Android a iOS. Primárne je Strava urèená pre becov a cyklistov, grafy a analıza pre ich aktivity sú najpodrobnejšie. Trénigovı denník si však môu vies aj ïalší športovci.\\
\indent Princíp fungovania Strava môeme popísa tromi krokmi. Prvım je absolvovanie tréningu a jeho zaznamenanie na zariadenie s GPS, resp. na ich mobilnú aplikáciu. Druhım krokom je uloenie tréningového záznamu na server Strava. Vïaka vyuitiu API vırobcov ako je Garmin, Suunto, TomTom, Timex a niektorıch dalších umoòuje Strava priame uloenie tréningovıch dát na server ihneï po pripojení zariadenia/športovıch hodiniek do poèítaèa. Priame ukladanie funguje na platformách Windows a OSX. Ak pouívate¾ pouíva inı operaènı systém alebo má záujem uloi tréning z iného zariadenia, môe tak urobi nahraním súboru, ktorı je vo formáte GPX, TCX alebo FIT. Tretím krokom je zobrazenie detailu tréningu a analıza. Údaje môeme prehliada vo forme mapy alebo grafov, ktoré zobrazujú priebeh celého tréningu, hodnoty aktuálnej nadmorskej vıšky, rıchlosti, tepovej frekvencie, frekvencie šliapania a~teploty v jednotlivıch pozíciách, viï obr. \ref{fig:strava_analysis}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.40]{images/strava_analysis.png}
\caption{Strava - Analıza tréningu}
\label{fig:strava_analysis}
\end{figure}

\indent Portál Strava sme sa rozhodli popísa z dôvodu, e ako jeden z prvıch prináša aproximáciu wattového vıkonu cyklistu z GPS dát. Aby sme aproximáciu mohli analyzova vzh¾adom na naše ciele, absolvovali sme 3 rôzne merania na úseku Tatranská Štrba - Štrbské pleso v dåke 1500m, so snahou udriava rovnomernı vıkon bez vıkyvov. Pri prvom sme zmerali vıkon zariadením Power Tap G3 a dáta zaznamenávali do cyklopoèítaèa Garmin Edge 500. Na obr. \ref{fig:strava_watts} môeme vidie reálnu hodnotu vıkonu. 
\begin{figure}[H]
\centering
\includegraphics[scale=0.60]{images/strava_uphill_chart_watts.png}
\caption{Strava - Graf vıkonu}
\label{fig:strava_watts}
\end{figure}

Druhı tréning bol zaznamenanı tie cyklopoèítaèom Garmin Edge 500 ale bez merania vıkonu. Na obr. \ref{fig:strava_estwatts}  môeme vidie vıkon odhadnutı algoritmom Strava z rıchlosti a nadmorskej vıšky. Môeme pozorova ve¾ké vıkyvy odhadnutého vıkonu v~rozmedzí od 0W do 867W, prièom dosahovaná rıchlos je plynulá a bez vıkyvov.  
\begin{figure}[H]
\centering
\includegraphics[scale=0.60]{images/strava_uphill_chart_deviceGPS.png}
\caption{Strava - Graf odhadnutého vıkonu pod¾a GPS}
\label{fig:strava_estwatts}
\end{figure}

Poslednı záznam je meranı mobilnou aplikáciou Strava, viï obr. \ref{fig:strava_estwatts_agps}. V tréningu sme vıkon opä nemerali a grafe môeme vidie odhadnuté hodnoty. Obrovské vıkyvy prisudzujeme odchılkam v pozícii a aj nadmorskej vıške. Pouitı mobilnı telefón Samsung Galaxy S4 mini nedisponuje barometrickım vıškomerom, hodnota nadmorskej vıšky je získaná z pozície. Ako je známe, GPS èip v mobilnıch telefónoch nedosahuje takú vysokú presnos ako špeciálne športové zariadenia a pozícia je èasto korigovaná aj mobilnımi sieami.
\begin{figure}[H]
\centering
\includegraphics[scale=0.60]{images/strava_uphill_chart_mobileGPS.png}
\caption{Strava - Graf odhadnutého vıkonu pod¾a Assisted GPS}
\label{fig:strava_estwatts_agps}
\end{figure}

\indent Z prezentovanıch testov môeme na prvı poh¾ad vyvodi záver, e odhad vıkonu portálom Strava nie je presnı. Chybné sú najmä hodnoty, ktoré skáèu z nuly do maximálnych hodnôt, a to aj napriek tomu, e športovec sa pohyboval takmer konštantnou rıchlosou a snail sa dodra rovnakú frekvenciu šliapania. Hoci nepoznáme presnı algoritmus vıpoètu v Strava, myslíme si, e príèinou nepresnosti je zvolenie prive¾mi malıch úsekov, na ktorıch sú vypoèítavané èiastkové vıkony, resp. sú vypoèítavané medzi jednotlivımi bodmi uloenımi do zariadenia. Na malom úseku môe by odchılka v nadmorskej vıške, nako¾ko barometrickı vıškomer ju urèuje pod¾a tlaku. Môe to by samozrejme aj nepresnosou GPS alebo malou frekvenciou ukladania jednotlivıch bodov tréningu, prièom nie sú zachytené všetky zmeny terénu.

\subsubsection{Bike Calculator}
Druhı systém relevantnı nášmu vıskumu nájdeme na webovej stránke\\ \emph{http://www.bikecalculator.com}. Bike Calculator je údajne najpopulárnejšia kalkulaèka vıkonu cyklistu fungujúca od roku 1997 \cite{bikecalculator}. U na prvı poh¾ad je jasné, e sa jedná iba o kalkulaèku a iaden vstup zo športovıch hodiniek alebo meraèa nie je monı. Stránka disponuje krátkym vysvetlením fyzikálneho problému vıpoètu vıkonu a formulárom, do ktorého je moné zada hodnoty pre vıpoèet a vısledok je vyhodnotenı okamite.
\begin{figure}[H]
\centering
\includegraphics[scale=0.50]{images/bikecalculator_calc.png}
\caption{Bike Calculator - Kalkulaèka vıkonu cyklistu}
\label{fig:bikecalculator_form}
\end{figure}

Otestovali sme ho pre 12 úsekov, z ktorıch kadı sme absolvovali 2-5 krát a vıkon merali zariadením PowerTap G3. Pri kadom meraní sa športovec snail dodriava rovnomernı vıkon. Nako¾ko Bike Calculator ani neumoòuje vkladanie èiastkovıch údajov, pouili sme priemer nameranıch hodnôt pre kadı úsek. V tabu¾ke \ref{table:bikecalculator_table} uvádzame porovnanie hodnôt z meraní a vypoèítanıch hodnôt.\\
\begin{table}[h]
\begin{tabular}{cccccccc}
\textbf{Úsek} & \textbf{\begin{tabular}[c]{@{}c@{}}dåka\\ {[}m{]}\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}priemer.\\ stúpanie\\ {[}\%{]}\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}priemer.\\ rıchlos\\ {[}km/h{]}\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}reálny\\ vıkon\\ {[}W{]}\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}Bike\\ Calculator\\ {[}W{]}\end{tabular}} & \textbf{Rozdiel} & \textbf{\begin{tabular}[c]{@{}c@{}}Rozdiel\\ {[}\%{]}\end{tabular}} \\ \hline
1. & 1000 & 7.4 & 13.5 & 269 & 247 & -22 & -8.18\% \\ \hline
2. & 1000 & 8.5 & 13.0 & 285 & 269 & -16 & -5.61\% \\ \hline
3. & 1000 & 10.2 & 11.9 & 285 & 289 & 4 & 1.40\% \\ \hline
4. & 1500 & 4.9 & 26.1 & 267 & 261 & -6 & -2.25\% \\ \hline
5. & 1500 & 6.6 & 15.6 & 272 & 263 & -9 & -3.31\% \\ \hline
6. & 1500 & 9.2 & 11.7 & 273 & 258 & -15 & -5.49\% \\ \hline
7. & 2700 & 3.0 & 20.4 & 201 & 197 & -4 & -1.99\% \\ \hline
8. & 2700 & 4.8 & 24.1 & 357 & 346 & -11 & -3.08\% \\ \hline
9. & 2700 & 5.2 & 17.5 & 257 & 245 & -12 & -4.67\% \\ \hline
10. & 1500 & 0.7 & 30.5 & 180 & 214 & 34 & 18.89\% \\ \hline
11. & 1500 & 1.2 & 26.5 & 211 & 177 & -34 & -16.11\% \\ \hline
12. & 1500 & 2.3 & 23.8 & 187 & 210 & 23 & 12.30\% \\ \hline
\end{tabular}
\caption{Bike Calculator - porovnanie vıpoètu}
\label{table:bikecalculator_table}
\end{table}
\\
\indent Z tabu¾ky si môeme všimnú, e celková dåka segmentu neovplyvòuje rozdiel medzi reálnou a vypoèítavanou hodnotou. Zámerne však neuvádzame úseky dlhé iba nieko¾ko desiatok metrov, aby sme mohli poukáza na fakt, e práve stúpajúci sklon (priem. stúpanie) robí vıpoèet presnejším. Minimalizuje sa toti aerodynamickı odpor spôsobenı vetrom, ktorého smer aj intenzitu je ve¾mi aké odhadnú a stúpa podiel sily potrebnej na prekonanie zemskej tiae.\\
\indent Ako môeme vidie vo formulári na obr. \ref{fig:bikecalculator_form}, typ pneumatík a pozíciu športovca na bicykli vyberáme z predvolenıch hodnôt. Pre typ pneumatík sú to tri hodnoty, a to pláše, galusky alebo MTB. Pozíciu môeme zvoli pod¾a bicykla - vzpriamená, mierne vzpriamená, zohnutá, aerodynamická. Pod¾a vybraného vstupu Bike Calculator pouije predvolenı koeficient valivého odporu, resp. aerodynamického odporu.\\
\indent Koeficient aerodynamického odporu je však závislı aj od obleèenia cyklistu, od bicykla, od kolies. Koeficient valivého odporu je rozdielny pre jednotlivé modely plášov, hodnotu ich nahustenia. Môeme poveda, e je rozdielny pre kadú jednu dvojicu športovec-bicykel. Dôkladnejšie vysvetlenie tejto problematiky uvádzame v kapitole \ref{Physics}.

\newpage
\section{Pôsobenie síl} \label{Physics}
Vıkon, ktorı musí cyklista vyvíja aby sa dokázal pohybova urèitou rıchlosou je úmernı odporovım silám, ktoré na neho a bicykel poèas jazdy pôsobia. V tejto kapitole sa budeme tımto odporovım silám venova podrobnejšie, aby sme v dostatoènej miere poznali na akıch velièinách sú závislé. Tieto znalosti následne vyuijeme pri návrhu algoritmu strojového uèenia. Jednotlivé zloky síl, ktoré pôsobia na cyklistu poèas jazdy sa menia v závislosti od zmeny terénu a poveternostnıch podmienok.
\begin{itemize}
 \item Gravitaèná sila
 \item Aerodynamickı odpor
 \item Valivı odpor
\end{itemize}
\indent Kım aerodynamickı odpor je najviac pociovanı pri jazde po rovine, jeho podiel klesá spolu s narastajúcim sklonom vozovky a zaèína prevláda zloka gravitaènej sily. Valivı odpor je spôsobenı kontaktom pneumatiky s povrchom vozovky, konkrétne ich deformáciou a mikrotrením.\\
\indent Princíp superpozície hovorí, e vısledná sila pôsobiaca na teleso je rovná vektorovému súètu všetkıch síl pôsobiacich na dané teleso \cite{encyklopedie_fyziky}.
\begin{equation} \label{eq:superposition}
\vec{F} = \sum_{\substack{i}}\vec{F}_i
\end{equation}

\subsection{Gravitaèná sila}
Pri pohybe cyklistu a bicykla v horizontálnej rovine je reakciou na gravitaènú silu normálová sila, ktorá zohráva úlohu pri valivom odpore (viï kapitola \ref{Rolling_resistance}). Akonáhle však športovec prekonáva nadmorskú vıšku, teda vo fyzikálnom pomenovaní sa pohybuje po naklonenej rovine, musí prekona aj zloku gravitaènej sily $F_g$, ktorá pôsobí proti smeru jeho pohybu. Zloky gravitaènej sily sú zobrazené na obr. \ref{fig:inclined_plane}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.5]{images/inclined_plane.png}
\caption{Teleso na naklonenej rovine}
\label{fig:inclined_plane}
\end{figure}

Silu pôsobiacu proti pohybu cyklistu v smere z kopca vyjadríme vzahom $F_g = m\ g \sin \alpha$. Kde $m$ je hmotnos sústavy, v našom prípade hmotnos športovca a bicykla a $g$ je gravitaèné zrıchlenie. Sínus pre uhol sklonu môeme vypoèíta zo zmeny nadmorskej vıšky $\Delta altitude$ a prejdenej vzdialenosti $d$:
\begin{equation} \label{eq:force_gravity}
F_g = m\ g\ \cfrac{\Delta altitude}{d}
\end{equation}

\noindent Ve¾kos normálovej sily, $F_g = m\ g \cos \alpha$, vyjadríme vzahom \ref{eq:force_normal}
\begin{equation} \label{eq:force_normal}
F_n = m\ g\ \sqrt{1 - \left(\cfrac{\Delta altitude}{d}\right)^{2}}
\end{equation}

\subsection{Aerodynamickı odpor}
Aerodynamickı odpor je v poslednom období v cyklistike èasto preberanou tématikou. Upravujú sa tvary trubiek bicyklov, menia sa profily kolies, vylepšujú sa materiály a strih obleèenia, všetko s cie¾om dosahovania vyšších rıchlostí bez nutnosti zvyšova vıkon. Zo vzahu \ref{eq:force_drag} \cite{drag_equation}
\begin{equation} \label{eq:force_drag}
F_d = \cfrac{1}{2}\ \rho\ v^2\ C_d\ A
\end{equation}
môeme vidie, e sila potrebná na prekonanie aerodynamického odporu rastie s druhou mocninou rıchlosti. $\rho$ je hustota prostredia. Referenèná plocha $A$ je v tomto prípade premietnutá èelná plocha športovca a bicykla. Jedinou monosou ako zníi odporovú silu je teda zníi koeficient odporu $C_d$.\\
\indent Koeficient odporu pre pohybujúce sa teleso $C_d$ je závislı od povrchu a aerodynamického tvaru telesa, ïalej od hustoty a viskozity látky  prostredia, v ktorom sa teleso pohybuje. Tie závisí od rıchlosti a smeru pohybu telesa vzh¾adom na smer pohybu látky prostredia (napr. smer vetra). Pre vysoké rıchlosti môeme $C_d$ vyjadri ako funkciu Reynoldsového èísla \emph{Re} a èísla \emph{Mach}. Pre rıchlosti, ktoré dosahujú automobily alebo bicykle môeme povaova $C_d$ za konštantnı. Ak uvaujeme nad aproximáciou vıkonu, zisujeme, e koeficient odporu ani referenènú plochu nevieme jednoducho mera a teda ich hodnoty poadova ako pouívate¾skı vstup do systému. Do úvahy pripadá ich odhad na základe známych proporcií športovca a reálne zmeraného vıkonu.\\
\indent Vo vzahu \ref{eq:force_drag} vystupuje hustota $\rho$, ktorá v našom prípade prestavuje hustotu vzduchu. Tá je pri 15°C na hladine mora rovná hodnote $1,2754\ kg\ m^{-3}$ \cite{standard_atmosphere}. Hustota vzduchu sa však mení so stúpajúcou teplotou a tie stúpajúcou nadmorskou vıškou, keïe sa mení tlak vzduchu. \\
\indent Atmosferickı tlak $p$ v nadmorskej vıške $h$ urèíme pod¾a vzahu \ref{eq:atmospheric_pressure},
\begin{equation} \label{eq:atmospheric_pressure}
p = p_0\ \left( 1 - \cfrac{L\ h}{T_0} \right)^{\cfrac{g M}{R L}}
\end{equation}
v ktorom figurujú nasledovné konštanty \cite{standard_atmosphere}:
\begin{itemize}
 \item $p_0$ - atmosferickı tlak na hladine mora - 101,325 $kPa$ 
 \item $T_0$ - štandardná teplota vzduchu - 288,15 $K$ = 15$°C$
 \item $g$ - gravitaèné zrıchlenie - 9,80665 $m\ s^{-2}$
 \item $L$ - teplotnı gradient - 0,0065 $K\ m^{-1}$
 \item $R$ - univerzálna plynová konštanta - 8,31447 $J\ mol^{-1}\ K^{-1}$
 \item $M$ -  molová hmotnos vzduchu - 0.028964 $kg\ mol^{-1}$
\end{itemize}
Pri známom tlaku vzduchu pre danú nadmorskú vıšku, môeme urèi hustotu vzduchu pri rôznej teplote $T$ vzahom \ref{eq:air_density}
\begin{equation} \label{eq:air_density}
\rho = \cfrac{p\ M}{R\ T}
\end{equation}
Zmena teploty a tlaku vzduchu ovplyvní aj vıkon potrebnı pre udranie rovnakej rıchlosti, a to nezanedbate¾nım rozdielom. Pre priblíenie uvádzame dve simulácie pohybu cyklistu rıchlosou 30 $km\ h^{-1}$ v horizontálnej rovine. V prvom prípade simulujeme pri konštantnej teplote zmenu nadmorskej vıšky z 0 m n.m.  do 1500 m n.m.\\
Simuláciu vykonávame s nasledovnımi konštantami:
\begin{itemize}
  \item $C_{rr}$ = 0.003, na základe \cite{handbook_rolling_resistance}
  \item $C_d$ = 1.0, na základe \cite{cycling_power_lab}
  \item $A$ = 0.4, na základe \cite{cycling_power_lab}
\end{itemize}
Z obr. \ref{fig:altitude_watt_comparsion} môeme vidie, e rozdiel v nadmorskej vıške sa prejavil rozdielom 12 W vo vıkone. 

\begin{figure}[H]
\centering
\includegraphics[scale=0.8]{images/altitute_watt_comparsion.png}
\caption{Závislos potrebného vıkonu od nadmorskej vıšky}
\label{fig:altitude_watt_comparsion}
\end{figure}

V druhom prípade pri konštantnej nadmorskej vıške 0 m n.m. simulujeme zmenu teploty. Stúpajúca teplota vzduchu sa prejaví zníením hustoty vzduchu, a teda aj vıkon potrebnı na udranie rovnakej rıchlosti klesá. Pri rovnakıch podmienkach ako v predchádzajúcom príklade a teplote 30°C, by postaèovalo cyklistovi na udranie rıchlosti 30 $km\ h^{-1}$ pribline o 9 W niší vıkon ne pri teplote 15°C, viï obr. \ref{fig:temperature_watt_comparsion}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.8]{images/temperature_watt_comparsion.png}
\caption{Závislos potrebného vıkonu od teploty vzduchu}
\label{fig:temperature_watt_comparsion}
\end{figure}

\subsection{Valivı odpor} \label{Rolling_resistance}
Valivım odporom môeme nazva silu, ktorá vzniká, keï sa teleso kruhového prierezu (v našom prípade koleso bicykla) valí po pevnej podloke. Fyzikálnou podstatou tohoto javu je hysterézia, ktorá nastáva pri deformácia podloky resp. kolesa pôsobením normálovej tlakovej sily. V reálnych podmienkach samozrejme podloka ani galuska kolesa nie sú dokonale pruné. Preto reakcia na normálovú tlakovú silu je posunutá o vzdialenos $\xi$ \cite{encyklopedie_fyziky}.
\begin{figure}[H]
\centering
\includegraphics[scale=1.0]{images/rolling_resistance.png}
\caption{Valivı odpor \cite{encyklopedie_fyziky}}
\end{figure}

\noindent Silu \emph{F}, ktorou predmet udríme v rovnomernom pohybe vyjadríme vzahom:
\begin{equation} \label{eq:rolling_trivial1}
F = F_n\ \tan \alpha
\end{equation}

\noindent Pre malé uhly je $tg\alpha = sin\alpha$ a pre koleso s polomerom \emph{R} je $sin\alpha = \cfrac{\xi}{R}$. Dosadením do vzahu \ref{eq:rolling_trivial1} dostávame:
\begin{equation} \label{eq:rolling_trivial2}
F = \cfrac{\xi}{R}\ F_n
\end{equation}

\noindent Normálovú silu na naklonenej rovine vypoèítame pod¾a vzahu \ref{eq:force_normal}.\\
\indent V praxi by ale bolo ve¾mi nároèné zmera vzdialenos $\xi$, preto sa podiel vo vzahu \ref{eq:rolling_trivial2} èasto nahrádza koeficientom valivého odporu $C_{rr}$. Koeficient môeme nájs pre rôzne typy pneumatík v tabu¾kách. Definovaním štandardov pri testovaní pneumatík ako je napríklad štandard SAE J2452 \cite{sae_test} sa vymedzujú podmienky testu. Pre potreby tejto práce je dôleité povaova podloku, povrch vozovky, ako dokonale pevnú a koeficienty valivého odporu galusiek alebo plášov cestného bicykla v rozsahu od 0.002 do 0.006 \cite{roller_data}. Na tıchto dátach môeme vykona ïalšiu simuláciu a prezentova, akı vplyv má koeficient odporu $C_{rr}$ na vıkon potrebnı pre udranie konštantnej rıchlosti 30 $km\ h^{-1}$, viï obr. \ref{fig:crr_watt_comparsion}. Dáta sú simulované s konštantami: $A$ = 0.4, $C_d$ = 1.0, $T$ = 15°C, $h$ = 100m n.m.

\begin{figure}[H]
\centering
\includegraphics[scale=0.8]{images/crr_watt_comparsion.png}
\caption{Závislos potrebného vıkonu od koeficientu odporu pneumatiky}
\label{fig:crr_watt_comparsion}
\end{figure}

Kım koeficient je pod¾a tabu¾ky nezávislı od tlaku, pretoe test predpokladá konštatné, ideálne nahustenie pneumatiky, v praxi tomu tak by nemusí. Nako¾ko je na trhu nespoèetné mnostvo modelov galusiek a plášov pre bicykle, nie je moné k nim uchováva a neustále aktualizova koeficient valivého odporu $C_{rr}$. Urèitú úlohu hrá aj tlak v pneumatike, ktorı kadı cyklista volí pod¾a svojich osobnıch preferencií, poadovanıch jazdnıch vlastností a komfortu. iada tlak v pneumatike ako vstup do systému od pouívate¾a povaujeme za ve¾mi nekomfortné. Oh¾adom dosadenia hodnoty za $C_{rr}$ sa dostávame do rovnakej situácie ako pri koeficiente $C_d$.
\subsection{Podiel jednotlivıch zloiek na celkovom odpore}
\indent Na záver tejto kapitoly chceme prezentova podiel jednotlivıch silovıch zloiek na celkovej sile pôsobiacej na cyklistu v závislosti od stúpajúceho sklonu vozovky. Nako¾ko dosiahnutie konštantnıch podmienok v teréne je takmer nemoné, opä nám vhodne poslúi simulácia. S hodnotami $A$ = 0.4, $C_d$ = 1.0, $T$ = 15°C, $h$ = 0m n.m., $C_{rr}$ = 0.0045, $m$ = 77kg a konštantnım vıkonom 350W simulujeme zmenu stúpania z 0\%
a do 15\%\\
\indent Z grafu na obr. \ref{fig:force_comparsion} pozorujeme, e valivı odpor má po celú dobu minimálny podiel na celkovej sile, avšak nemôeme ho zanedba. A tie, e podiel gravitaènej sily a aerodynamického odporu sa vyrovnáva pribline pri 2.5\% stúpaní. 

\begin{figure}[H]
\centering
\includegraphics[scale=0.9]{images/force_comparsion.png}
\caption{Podiel silovıch zloiek v závislosti od stúpajúceho sklonu vozovky}
\label{fig:force_comparsion}
\end{figure}

\indent Ïalšou skutoènosou, ktorá súvisí najmä s aerodynamickım odporom je vietor. Smer a intenzitu vetra poèas tréningu by bolo ve¾mi nároèné urèi. Hoci by sme mohli vyui API predpovede poèasia, získané údaje nevieme garantova pre rôzne segmenty trasy, keïe vietor sa môe láma medzi budovami alebo stromami. Ïalším faktorom je aj ve¾kos skupiny, v ktorej cyklista tréning absolvuje. Je samozrejmé, e v závetrí väèšej skupiny športovec šetrí silu. To, ako presne sa tieto dva faktory odzrkad¾ujú na vıkone, u poveda nevieme a jediná cesta dosiahnutia presnıch vısledkov by bola testovanie vo veternom tuneli. Takéto testovanie by však bolo nielen èasovo ale aj finanène nároèné, a preto sme v rámci rozsahu našej práce uprednostnili èo mono najpresnejšiu aproximáciu v známych podmienkach.\\
\indent V našej aproximácii budeme predpoklada, e smer a intenzita vetra, má zanedbate¾nı vplyv na vıkon, resp. pri dlhších a k¾ukatıch úsekoch je v niektorıch èastiach jeho intenzita prièítaná a v inıch zase odèítaná z celkového aerodynamického odporu. Vıkon sa môeme snai aproximova v úsekoch kedy podiel aerodynamického odporu na celkovej pôsobiacej sile je èo najniší. Dobré vısledky by mohli by dosahované pri aproximácii v stúpaniach nad 3\% priemerného sklonu, kedy sa podiel gravitaènej sily a aerodynamického odporu vyrovnáva.

\newpage
\section{Opis riešenia}
Doposia¾ prezentovanú štúdiu nenecháme iba v teoretickej rovine, ale implementujeme èas webovej aplikácie, ktorá pouívate¾ovi umoní nahranie súboru s tréningovımi dátami na server, odhadne podávanı vıkon a zobrazí dáta vo forme grafov a mapy. Vısledná funkèná èas bude nadväzova na aplikáciu z našej bakalárskej práce \emph{Webovı organizér}. Spoloène budú tvori funkènı celok s monosami komplexnej analızy tréningu.\\
\indent Hlavnım cie¾om tejto práce je aproximácia podávaného vıkonu na základe údajov z nepriamych meraní. U pred zaèaním prác bola na mieste otázka, èi je moné odhadova vıkon v tak premenlivıch podmienkach, aké môeme pri pohybe na bicykli vo vonkajšom prostredí uvaova. Na základe empirickıch skúseností sme usúdili, e s vınimkou extremnıch podmienok v okolitom prostredí, by mohla by aproximácia relatívne presná. Následne bolo otázne, èi údaje, ktoré poèas tréningu zaznamenáme, postaèova na to, aby vısledok aproximácie mohol do urèitej miery konkurova cenovo nároènému komponentu, meraèu vıkonu. Pri analıze sme zoh¾adnili moné nepresnosti:
\begin{itemize}
  \item pri urèovaní polohy cez GPS a teda aj nepresnos vo vzdialenosti a rıchlosti
  \item pri zázname zmeny nadmorskej vıšky barometrickım vıškomerom, pri zmenách tlaku, teploty
  \item pri zázname zmeny nadmorskej vıšky cez GPS, nepresnos pri urèovaní polohy
  \item vo vzorovıch dátach, odchılka zmeraného a skutoèného vıkonu (vyrobcami uvádzaná odchılka 2\%)
  \item vplyv zotrvaènosti pri krátkych zmenách v rıchlosti pohybu.
\end{itemize}
Po dôslednejšom preskúmaní dát, ktoré sú z meraèov k dispozícii sme ia¾ museli pripusti, e nie sú nato¾ko presné, aby sme z nich mohli aproximova krátke nieko¾ko sekundové intenzívne vıkony. Vıkon pri krátkych zrıchleniach (3 a 5 sekúnd) pri súèasnej presnosti dát nedokáeme odhadnú s uspokojujúcou presnosou. Uvaovali sme teda o rozdelení priebehu tréningu na úseky dlhé v priemere 40 a 150 m a pracova s priemernım stúpaním a rıchlosou, od èoho sme si s¾ubovali odstránenie nepresností pri vıpoète.\\
\indent Popísaním odporovıch síl, pôsobiacich na cyklistu, vzahmi \ref{eq:force_gravity}, \ref{eq:force_drag}, \ref{eq:rolling_trivial1}, sme zistili, e k fyzikálnemu vıpoètu vıkonu by boli potrebné koeficienty $C_d$, $A$, $C_{rr}$, ktoré nevieme zisti jednoduchım meraním, ani ich globálne zovšeobecni pre všetkıch športovcov. Ako vhodné sa javí pouitie strojového uèenia, pod¾a \cite{machine_learning}, oblasti umelej inteligencie, ktorá sa snaí automaticky h¾ada zmysluplné vzory v dátach.

\subsection{Strojové uèenie}
Podstatou strojového uèenia je vyuitie automatizovanıch procedúr zaloenıch na logickıch alebo binárnych operáciách, pomocou ktorıch sa stroj z dát uèí a zároveò dáta prevdída. V strojovom uèení je dôleitı pojem zovšeobecnenie\footnote{zovšeobecnenie - z angl. generalization}, v zmysle schopnosti primerane reagova na nové vstupné vzorky, po rozpoznaní vzorov v trénovacej mnoine. Algoritmy strojového uèenia pracujú s vytvorenım modelom vstupov a majú za cie¾ predvída alebo klasifikova vıstupy. Pod¾a \cite{machine_learning}, na základe druhu uèenia rozoznávame tri základné typy strojového uèenia:
\begin{itemize}
  \item \emph{Supervised} - uèenie so vzrom - k vektoru vstupnıch trénovacích dát je danı vzorovı vektor vıstupov.
  \item \emph{Unsupervised} - uèenie bez vzoru- k vstupnım dátam nie je danı vıstup.
  \item \emph{Reinforcement} - uèenie so spätnou väzbou - na základe vstupnıch dát je vykonávaná akcia, jej vhodnos je bodovo hodnotená. Algoritmus upraví stratégiu s cie¾om získa èo najvyššie bodové hodnotenie. Pouívanı hlavne v robotike.
\end{itemize}

\indent Existuje ve¾ké mnostvo konkrétnych algoritmov, preto ich nebudeme individuálne menova, ale posnaíme sa obmedzi vıber na základe nášho cie¾a. Ak by sme chceli získa chıbajúce koeficienty $C_d$, $A$, $C_{rr}$ museli by sme zvoli \emph{unsupervised learning} - uèenie bez vzoru, pretoe trénovacie dáta pre tieto koeficienty nemáme k dispozícii. V tomto smere sa však nenaskytoval iaden vhodnı postup, ktorım by sme mohli nájs koeficienty ako vıstup z funkcie vstupov. \\
\indent Vhodnejšie sa teda javí zvoli uèenie so vzorom. Zostavíme model vstupov (dostupnıch tréningovıch dát) a pre ne ako vzor zodpovedajúci vıkon cyklistu. Pri vıbere vhodnıch trénovacích dát, správnej konfigurácii a tréningu, by algoritmus mohol by schopnı rozpozna vzahy medzi vstupmi a vzorovım vıstupom a v praxi potom aproximova vıkon cyklistu iba na základe vstupov z nepriamych meraní.\\
\indent Ak z úvah vylúèime algoritmy strojového uèenia, ktoré sa pouívajú na klasifikáciu vzoriek do tried, a zameráme sa na tie, ktorımi môeme aproximova funkciu, pripadajú do úvahy \emph{Umelé neurónové siete} a \emph{Rozhodovacie regresné stromy}.\\
\indent \textbf{Rozhodovacie regresné stromy} predpovedajú vıstup na základe podmienok v postupnom slede od koreòa stromu a ku koncovım uzlom. Koncové uzly majú hodnotu vıstupu stromu.\\
\indent \textbf{Umelé neurónové siete} je model vıpoètu inšpirovanı štruktúrou ¾udského nervového systému. Nervovı systém v zjednodušenom ponímaní pozostáva z ve¾kého poètu základnıch vıpoètovıch jednotiek - \textbf{neurónov} navzájom pospájanıch \textbf{dendritmi} do komplexnej siete, v ktorej medzi sebou komunikujú. Umelá neurónová sie je formálna vıpoètová konštrukcia zaloená na tejto štruktúre. Môeme ju popísa ako orientovanı graf, ktorého uzly zodpovedajú neurónom a hrany medzi nimi reprezentujú dendrity. Spoloènım znakom umelıch neurónovıch sietí je mnoina adaptívnych hrán, ktoré sa upravujú tréningom. Práve vïaka adaptívnym spojovacím hranám, má neurónová sie schopnos uèenia sa. Aplikácie neurónovıch siete nájdeme pre viacero problémov, ve¾mi èasto sa okrem klasifikácie do tried pouívajú aj na aproximáciu vo všeobecnosti neznámych funkcii viacerıch vstupov.
\begin{figure}[H]
\centering
\includegraphics[scale=0.1]{images/neural_net.png}
\caption{Neurónová sie}
\end{figure}

Neurónová sie je zloená zo vstupnej a vıstupnej vrstvy. Volite¾ne, pod¾a aplikácie na konkrétny problém, môe ma sie aj jednu a viac skrytıch vrstiev. Sie bez skrytej vrstvy sa nazıva perceptrón a pouíva sa na klasifikáciu vstupov do dvoch tried\cite{machine_learning}. Vstupná vrstva pokrıva poèet vstupov/atribútov, distribuuje vstupné signály do ïalšej vrstvy siete. Poèet neurónov vo vıstupnej vrstve zodpovedá iadanému poètu vıstupov. Skrytá a vıstupná vrstva majú vıpoètové funkcie.
\begin{figure}[H]
\centering
\includegraphics[scale=0.25]{images/neuron.png}
\caption{Neurón}
\end{figure}

Kadı neurón prijíma ako vstup váenı súèet vıstupov neurónov pripojenıch k jeho vstupnım hranám. Vıstup nerónu zoh¾adnuje prah citlivosti neurónu a \emph{aktivaènú funkciu} neurónu, èo môeme popísa vzahom \ref{eq:combination_function}. Niektoré zdroje, napr. \cite{efficient_backprop} to referujú ako \emph{kombinaèná funkcia}. Vstupom do kombinaènej funkcie je vektor hodnôt (x), vıstupom skalárna hodnota (y).

\begin{equation} \label{eq:combination_function}
y = f\Big(\sum_{i=1}^{n}(w_i x_i)-\theta \Big) = f(a)
\end{equation}

Cie¾om pri uèení neurónovej siete je opakovanım spracovaním tréningovıch vzoriek a úpravou váh minimalizova rozdiel (chybu) medzi vıstupom siete a poadovanım (vzorovım) vıstupom. Mnostvo algoritmov pouívanıch na trénovanie neurónovej siete je zaloenıch na vıpoète gradientu chyby. Algoritmom spätného šírenia chyby sa vypoèítava podiel váhy hrany na celkovej chybe, na základe ktorého sú jednotlivé hrany postupne upravované.

\subsection{Pouité technológie a riešenia}
Bakalárska práca \emph{Webovı organizér}, predstavovala webovú aplikáciu s monosou manuálneho ukladania absolvovaného aj plánovaného tréningu s monosami sumarizácie tréningového objemu pre vybrané obdobie. Ponúkala aj jednoduché sociálne funkcie, ako napríklad vyh¾adávanie priate¾ov a nastavenie súkromia. Serverová strana aplikácie \emph{Webovı organizér} bola naprogramovaná v jazyku PHP s pouitím frameworku \emph{Yii}. Ako databázovı server bol pouitı MySQL. Klientská èas stála na jazyku HTML, JavaScript a samozrejme CSS.\\
\indent V nadstavbe, ktorá bude vytvorená v rámci diplomovej práce, sa o serverovú stranu bude stara rovnako programovı kód v jazyku PHP, avšak pre naše potreby sme vytvorili vlastnı minimalistickı framework. Hlavnım dôvodom bola snaha dosiahnú vyššiu rıchlos spracovania skriptov, a to minimalizovaním volaní nepotrebnıch funkcií frameworku a jednoduchšia rozšírite¾nos. Vytvorenı framework implementuje návrhovı vzor \emph{Model-View-Controller} a \emph{Singleton}. Presnı popis štruktúry ani fungovanie frameworku uvádza nebudeme, nako¾ko nie je predmetom tejto práce, ani by ho nebolo moné vtesna do rozsahu vyhradeného pre túto kapitolu. Zjednošenú architektúru vytvorenej aplikácie uvádzame na obr. \ref{fig:mcore}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.33]{images/mcore.png}
\caption{Architektúra webovej aplikácie}
\label{fig:mcore}
\end{figure}

\indent Nová èas aplikácie úplne preberie na starosti ukladanie a zobrazovanie tréningov. Oproti bakalárskej práci bude pozmenená monos uloenia manuálneho záznamu tréningu a zobrazenie tréningov. Navyše bude pridané ukladanie tréningu s nahraním dátového súboru a jeho analıza, tj. zobrazenie dát v grafoch a aproximácia vıkonu.\\
\indent Na ukladanie dát vyuijeme existujúce schémy z bakalárskej práce v MySQL databáze, ktoré len mierne modifikujeme, pridáme niektoré tabu¾ky a nieko¾ko novıch ståpcov spolu s cudzími k¾úèmi.\\
\indent Údaje o tréningu, ktoré aplikácia prijme vo forme FIT súboru, konvertujeme pouitím \emph{FIT SDK conversion tool} do CSV a uloíme do databázy. Nako¾ko hodnoty sú športovımi hodinkami poèas tréningu ukladané pribline kadú sekundu a kadıch pä sekúnd, v priemere pracujeme so súbormi, ktoré obsahujú od 1 000 do 30 000 jednotlivıch bodov a pre kadı informácie o polohe, èase, rıchlosti, nadmorskej vıške, teplote, tepovej frekvencii, frekvencii šliapania, vıkone atï. Spoèiatku sme sa obávali ve¾kosti tıchto dát a poètu riadkov v príslušnej databázovej tabu¾ke. Pre prvotné úèely aplikácie, by však MySQL databáza mala by postaèujúca. V produkènom móde môe by tabu¾ka pre tréningové dáta nahradená dátovım úloiskom \emph{Big Table} alebo podobne. \\
\indent Vıstup serverovej èasti aplikácie bude vo forme HTML5, ktorı na strane klienta do finálneho zobrazenia dotvorí programovı kód v jazyku JavaScript. Jedná sa najmä o vykreslenie grafov, èo umoòuje kninica \emph{D3.js}\cite{d3js}.\\
\indent Jednoduchı, prezentovate¾nı dizajn vytvoríme v CSS s pouítím frameworku \emph{Bootstrap}\cite{bootstrap}, vïaka ktorému aplikácia získa responzívny dizajn.

\subsection{Prípady pouitia} \label{use_case_section}
Nišie uvádzame popisy jednotlivıch prípadov pouitia, ktoré pokrıva naša aplikácia. Diagram s prípadmi pouitia je zobrazenı na obr. \ref{fig:diagram_usecase}.\\

\noindent\textbf{UC\_01 Prihlásenie do systému}
\begin{itemize}[noitemsep]
\renewcommand{\labelitemi}{$-$}
  \item \underline{Popis:} prihlásenie pouívate¾a do systému prostredníctvom jeho emailu a hesla
  \item \underline{Vstupné podmienky pre pouívate¾a:} správne heslo a email pouitı pri registrácii
  \item \underline{Chybovı tok:} nesprávne vstupné údaje, pouívate¾ môe akciu opakova
  \item \underline{Zmena stavu systému:} prihlásenie a presmerovanie na poadovanú alebo hlavnú stránku
\end{itemize}

\noindent\textbf{UC\_02 Manuálne uloenie tréningovıch údajov}
\begin{itemize}[noitemsep]
\renewcommand{\labelitemi}{$-$}
  \item \underline{Popis:} športovec uloí údaje o športovej aktivite
  \item \underline{Vstupné podmienky pre pouívate¾a:} UC\_01, zadanie dátumu v ktorom bol tréning vykonanı, názvu, trvania
  \item \underline{Chybovı tok:} chıbajúce údaje je nutné opravi
  \item \underline{Zmena stavu systému:} zobrazenie tréningu UC\_04
\end{itemize}

\noindent\textbf{UC\_03 Uloenie tréningovıch údajov zo športového meraèa}
\begin{itemize}[noitemsep]
\renewcommand{\labelitemi}{$-$}
  \item \underline{Popis:} športovec uloí údaje o tréningu nahraním dátového súboru (FIT, GPX, TCX)
  \item \underline{Vstupné podmienky pre pouívate¾a:} UC\_01, nahranie minimálne jedného dátového súboru
  \item \underline{Chybovı tok:} môe nasta, ak sa niektorı súbor nepodarí nahra, nepodarí sa ho konvertova, nepodarí sa naèíta údaje. Chybnı súbor je moné nahra znovu.
  \item \underline{Zmena stavu systému:} zobrazenie tréningu UC\_04
\end{itemize}

\noindent\textbf{UC\_04 Zobrazenie tréningu}
\begin{itemize}[noitemsep]
\renewcommand{\labelitemi}{$-$}
  \item \underline{Popis:} detailnı náh¾ad uloeného tréningu, ak záznam o tréningu obsahuje aj údaje zo športového meraèa, zobrazia sa informácie vo forme grafu a mapy
  \item \underline{Vstupné podmienky pre pouívate¾a:} poiadavka na detailné zobrazenie konkrétneho tréningu
  \item \underline{Chybovı tok:} nemôe nasta
  \item \underline{Zmena stavu systému:} naèítanie a zobrazenie aktivity
\end{itemize}

\noindent\textbf{UC\_05 Odhlásenie}
\begin{itemize}[noitemsep]
\renewcommand{\labelitemi}{$-$}
  \item \underline{Popis:} Odhlásenie zo systému
  \item \underline{Vstupné podmienky pre pouívate¾a:} poiadavka na odhlásenie
  \item \underline{Chybovı tok:} nemôe nasta
  \item \underline{Zmena stavu systému:} vymazanie session pouívate¾a
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[scale=0.3]{images/diagram_usecase.png}
\caption{Diagram prípadov pouitia}
\label{fig:diagram_usecase}
\end{figure}

\subsection{Diagram aktivít}
V tejto èasti uvádzame diagram pre priebeh najdôleitejšej aktivity v aplikácii. Nasledujúci diagram aktivít konkrétne popisuje akcie, ktoré sú vykonané v prípade pouitia \emph{UC\_03}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.22]{images/diagram_activity.png}
\caption{Diagram aktivít}
\label{fig:diagram_activity}
\end{figure}
\noindent Ako sme spomenuli v predchádzajúcej èasti, po nahraní dátového súboru pouívate¾om na server nasleduje jeho rozbor a naèítanie dát. V prípade, e sa jedná o binárny FIT súbor, naèítaniu predchádza konverzia súboru do CSV formátu. Tok v systéme pokraèuje uloením údajov do~databázy. Ak bol tréning absolvovanı s meraèom vıkonu, záznam z tréningu sa zobrazí pouívate¾ovi. Ak vıkon medzi údajmi chıba detekujú sa segmenty, na ktorıch bude odhadovanı vıkon. Následne sa inicializuje vopred natrénovaná neurónová sie a údaje zo segmentov sa postupnej posielajú na jej vstup. Vıstup siete sa pridá medzi údaje o tréningu a tie sa uloia do databázy. Pri ïalšom zobrazení tréningu vıpoèet cez neurónovú sie u neprebieha, pouijú sa uloené dáta.\\

%
%
%
% PRETRIEDI
%
%
%
\subsection{Implementácia}
V tejto èasti podrobne preberieme implementáciu algoritmu pre aproximáciu vıkonu cyklistu. V predchádzajúcich èastiach sme sa zaoberali úvahami o presnosti rôznych odhadov, vysvetlili sme vıpoèet a ukázali podiel jednotlivıch zloiek na celkovej sile potrebnej pri pohybe cyklistu. Táto štúdia nás viedla k záveru, e dostatoènú presnos môeme dosiahnú pri aproximácii vıkonu v úsekoch, v ktorıch je priemernı sklon aspoò 3\%, celková dåka úseku aspoò 500 metrov a násobok sklonu v èíselnom vyjadrení a dåky úseku je väèší ako 40. Môe teda ís o kratšie, prudšie úseky alebo dlhšie s miernejším stúpaním. Hranièné príklady úsekov sú napr.:
\begin{itemize}
 \item dåka 500 m, priemernı sklon 0.08
 \item dåka 1 334 m, priemernı sklon 0.03
\end{itemize}
Empirickım overením sme dospeli k záveru, e u pri úsekoch tejto dåky a sklonu, rıchlos získaná zotrvaènosou prispieva k pohybu zanedbate¾ne v premietnutí na celı sledovanı úsek. Rıchlos, ktorou sa športovec v stúpaní pohybuje, je teda získaná vıhradne podávaním jeho vıkonu.\\
\subsubsection{Nahranie a konverzia súboru}
Skôr, ne môeme samotné dáta analyzova, potrebujeme umoni pouívate¾ovi aby ich mohol na server nahra. V našom frameworku máme implementované mapovanie cesty v URL adrese na príslušnı ovládaè a jeho metódu. To znamená, e cesta \emph{/upload/files/} spúša metódu \emph{files()} v triede \emph{UploadController}. Pokia¾ pri tejto poiadavke nie sú metódou \emph{POST} odoslané iadne súbory, iba vyuijeme metódu frameworku \emph{render()} a zobrazíme náh¾ad \emph{(view)} s formulárom pre nahranie súboru.

\begin{Verbatim}[baselinestretch=0.75]
if( !empty($_FILES) ){
    /* Spracovanie súborov prebehne tu */
}
else{
    /* V opaènom prípade sa zobrazí formulár */
    $this->render('files', array() );
}
\end{Verbatim}
Aplikácia umoòuje nahra viac súborov súèasne. Jediné obmedzenie je na strane servera, v konfigurácii PHP treba obmedzi parametre \emph{upload\_max\_filesize} a \emph{post\_max\_size} na poadovanú ve¾kos. Pred presunutím súboru na server sa skontroluje, èi sa jedná o súbor FIT a PHP funkciou \emph{move\_uploaded\_file} je následne presunutı do zloky \emph{/uploads/activities\_raw/}, pod názvom s nasledujúcim tvarom: \emph{IDpouívate¾a\_hashNázvu.fit}.\\
\indent Ihneï po presunutí súboru na server vykonáme jeho konverziu. Nasledujúci úryvok kódu spustí Java program, ktorı konvertuje binárny FIT súbor do CSV.

\begin{Verbatim}[baselinestretch=0.75]
exec(
    'java -jar ' . MCORE_APP_PATH . 'libraries/FitCSVTool.jar -b '.
    "{$inputpath} {$outputpath}"
);
\end{Verbatim}

Ïalším krokom v metóde \emph{files()} je spracovanie CSV súboru, k èomu je urèená trieda \emph{Csv\_activity\_parser}. Tá dedí od všeobecnej triedy \emph{CSVparser}, ktorú sme naimplementovali ako súèas kniníc vo frameworku a postará sa o otvorenie súboru a naèítanie hlavièky. Keïe v CSV súbore je ve¾ké mnostvo riadkov, metóda, ktorá èíta zo súboru musí by èo najrıchlejšia. V tomto stave pouívate¾ stále èaká na spracovanie jeho vstupnıch súborov. Nišie uvedenı kód uloí do po¾a všetky riadky s príznakom \emph{session} alebo \emph{record}.

\begin{Verbatim}[baselinestretch=0.75]
while(($row = fgetcsv($this->f, 0, $this->dlm, $this->enc)) != NULL){
            
    if( $row[2] == 'record' && $row[0] == 'Data' ){   
	$i = $field1_start;
	
	while( $i+2 <= count($row) ){
	    $this->record[$data_index][$row[$i]] = $row[$i+1];
	    $this->units[$row[$i]] = $row[$i+2];
	    $i+=3;
	}
	$data_index++;
    }
    elseif( $row[2] == 'session' && $row[0] == 'Data'){
	$i = $field1_start;
	while( $i+2 <= count($row) ){
	    $this->session[$row[$i]] = $row[$i+1];
	    $i+=3;
	}
    }   
}
\end{Verbatim}

Presunieme pozornos spä do triedy \emph{UploadController}. Na konci metódy \emph{files()} je ešte potrebné uloi údaje do databázy a umoni pouívate¾ovi pridanie názvu a popisu. Sumarizáciu tréningu uloíme do tabu¾ky \emph{training\_entry} cez model \emph{WorkoutModel}

\begin{Verbatim}[baselinestretch=0.75]
$w_model = new WorkoutModel(); 
                
$w_model->id_user = $user_id;
$w_model->start_time = $session_data->start_time + EPOCH_TIMESTAMP_OFFSET;

/* Kvôli struènosti vynechané priradzovanie niektorıch údajov */

$w_model->total_timer_time = $session_data->total_timer_time;
$w_model->total_elapsed_time = $session_data->total_elapsed_time;

if( $w_model->save(TRUE) ){

    $this->renderPartial(
	  'update.form', 
	  array('model' =>$w_model, 'activities' =>$activities), 
	  'workout'
    );
}
\end{Verbatim}

Tımto je nahratie súborov ukonèené a pouívate¾ovi sa zobrazí stránka, na ktorej môe zmeni typ športu, prida tréningu názov a popis.

\subsubsection{Detekcia stúpaní}
Aby mohla by vykonaná samotná aproximácia vıkonu, musí by z priebehu tréningu detekované, kde sa zaèínajú a konèia stúpania, ktoré vyhovujú stanovenım podmienkam (minimálne 3\% sklon a 500 m dåka). V skutoènosti je priebeh tréningu síce spojitı, no hodnoty, s ktorımi pracujeme sú diskrétne. Najjednoduchšou monosou detekcie je teda iterácia cez všetky body a overovanie nadmorskej vıšky. Aby sme zjednotili údaje, ktoré reprezentujú vybranı úsek v tréningu a udrali programovı kód konzistentnı, vytvorili sme jednoduchú triedu \emph{SegmentModel}\\

\begin{Verbatim}[baselinestretch=0.75]
class SegmentModel {
    
    /** @var int Zaèiatoènı index segmentu v dátach */
    protected  $index_start;
    
    /** @var int Koncovy index segmentu v dátach */
    protected  $index_end;
    
    /** @var float Dåka segmentu */
    protected  $length;
    
    /** @var float Rozdiel v nadmorskej vıške */
    protected  $elevation;
    
    /** Konštruktor segmentu */
    public function __construct( 
	$index_start, $index_end, $length, $elevation 
    ) {
        
        $this->index_start = $index_start;
        $this->index_end   = $index_end;
        $this->length      = $length;
        $this->elevation   = $elevation;
    }
    
    /** Vypoèíta sklon stúpania pre segment */
    public function grade(){        
        return $this->elevation / $this->length;
    }
      
    /* ... get metódy */
}
\end{Verbatim}

Detekciu úsekov ako aj aproximáciu vıkonu, ku ktorej sa dostaneme neskôr, má na starosti trieda \emph{Analyzer}. V prvom kroku metódy \emph{detect\_climbs()} sú detekované všetky neklesajúce úseky, následne sú nevyhovujúce odstránené.

\begin{Verbatim}[baselinestretch=0.75]
public function detect_climbs( WorkoutModel $workout ){
    /* ... Naèítanie dát */
    
    for( $i = 0; $i < count($this->data); $i++ ){
	if( empty($this->data[$i]['distance']) ){ continue; }
	
	$start = [ /* index, distance, altitude */ ];
	while($this->data[$i]['altitude']<$this->data[$i+1]['altitude']){ 
	    $i++; 
	}
	$end = [ /* index, distance, altitude */ ];
	
	$climbs[] = new SegmentModel(
	    $start['index'], $end['index'],
	    $end['distance'] - $start['distance'],
	    $end['altitude'] - $start['altitude']
	);
    }
    
    //** Odstrani nevyhovujuce stúpania
    foreach ( $climbs as $k =>$climb ){
	
	if( !($climb->get_length()>= 500 
	    && $climb->grade()>= 0.03 
	    && $climb->get_length() * $climb->grade()>40) )
	{
	    unset($climbs[$k]);
	}
    }
}
\end{Verbatim}

V tomto momente máme detekované stúpania, v ktorıch chceme vıkon aproximova. Ideálna by bola aproximácia, ktorá by pre kadı uloenı bod v tıchto stúpaniach urèila konkrétnu hodnotu vıkonu. Vyrátavali by sa teda priemerné vıkony medzi jednotlivımi bodmi, ktoré boli uloené na tréningu v priebehu stúpaní. Od tejto úvahy sme však upustili, nako¾ko si myslíme, e by nepresnos GPS a barometrického vıškomera pri vıpoète znásobovala odchılku od reálneho vıkonu. Preto v ïalšom kroku delíme stúpania na menšie èasti, tzv. segmenty, na ktorıch je konštantné stúpanie a pri snahe športovca o èo najplynulejšiu jazdu predpokladáme aj rovnomernú rıchlos.\\
\indent H¾adanie úsekov s konštantnım stúpaním nevykonávame jednoduchım prechádzaním cez všetky dáta a vzájomnım porovnávaním aktuálneho a nasledujúceho bodu. Lepšie rozdelenie stúpania dostávame h¾adaním, pri ktorom vytvárame úseèku z bodu \emph{N} a {N+x}, kde \emph{x} je vopred definovanı krok. Túto úseèku následne porovnáme s úseèkou vytvorenou medzi \emph{N+1} a {N+x+1}. Nároènos algoritmu je rovnaká ako v prípade, kedy by sme porovnávali body medzi sebou jednotlivo, cyklus prejde cez všetky body. Vytváraním dlhších úseèiek však minimalizujeme odchılky vıškomera. Kım prvou spomenutou metódou by sme dostávali úseky tvorené 2 a 3 bodmi, pouitou metódou je to v priemere 5 a 10 bodov, tj. v priemere 40 a 150 m, v závislosti od rıchlosti pohybu a frekvencie ukladania dát.\\
\indent Princíp detekcie segmentov pre lepšiu predstavivos zobrazujeme na obr. \ref{fig:segment_determination}. Kadá úseèka je vytvorená medzi bodmi \emph{N} a {N+x}, kedy N je navyšované pri kadej iterácii. Sklon úseèky 1 je porovnanı so sklonom úseèky 2. Ak je rozdiel sklonu väèší ako 0.005 predpokladáme, e leia nad samostatnımi segmentami. Pri tomto porovnávaní však môeme natrafi na prípad, kedy by nasledujúci segment mal zaèína pod úseèkou, presne ako na obr. \ref{fig:segment_determination}, pod úseèkou 2. Preto po nájdení úseèiek s rozdielnımi sklonmi ešte rozdelíme aj samotnú úseèku a celı proces porovnania sklonov zopakujeme, kım nie je urèenı koniec jedného segmentu a zaèiatok nového. 

\begin{figure}[H]
\centering
\includegraphics[scale=0.75]{images/segment_determination.png}
\caption{Detekcia segmentu}
\label{fig:segment_determination}
\end{figure}

\begin{Verbatim}[baselinestretch=0.75]
private function detect_segments( SegmentModel $climb ){

$step = 10;

for( $i = $i+1; $i <= $climb->get_index_end() - $step; $i++ ){
            
    //** Spoèíta gradient
    $length = $this->data[$i+$step]['distance'] 
	    - $this->data[$i]['distance'];
    $elevat = abs($this->data[$i+$step]['altitude'] 
	    - $this->data[$i]['altitude']); 
    $grade  = $elevat / $length;
    if( abs($grade - $grade_prev)>0.005 && $i-$seg_start>$step){
	/* Rozdelenie segmentu */
	/* Pokraèuje v detekcii presného zaèiatku a konca */
    }
    $seg = new SegmentModel( /* Potrebné hodnoty */ );
}
\end{Verbatim}

\subsubsection{Zobrazenie tréningu}
Hlavnou poiadavkou pri zobrazení tréningu s GPS údajmi, je monos prehliada absolvovanı tréning na mape a monos zobrazi jednotlivé body ¾ahko èitate¾nou formou, teda ideálne formou grafu.\\
\indent Prvú poiadavku splníme vïaka API od Google Maps. Aplikaèné rozhranie umoòuje zobrazi a vycentrova mapu pre konkrétnu polohu alebo mnoinu bodov, vykresli body alebo ich spojením priamo vytvori krivku. Prikreslením ïalšej krivky do mapy môeme zvırazni konkrétny úsek v tréningu pod¾a priblíenia/selekcie v grafe. Do mapy je taktie moné prida ukazovate¾ pozície. O vykreslenie mapy s tımito monosami sa postará nasledovnı kód, ktorı sa nachádza v náh¾adovom súbore \emph{/views/workout/view.chart.php}. Keïe sa jedná o Javascript, je len odoslanı do prehliadaèa a svoju funkciu vykoná sa a na strane klienta. Vısledok je následne zobrazenı na obr. \ref{fig:inhillz_map}

\begin{Verbatim}[baselinestretch=0.75]
<script type="text/javascript">
    
function map_initialize() {
  /* ... definovanie štılu a nastavení mapy */
	  
  style = new google.maps.StyledMapType(map_styles);
  
  route_coordinates = [<?php echo $coordinates ?>];
		  
  route_path = new google.maps.Polyline({
      path: route_coordinates,
      geodesic: true,
      strokeColor: '#33CC99',
  });
	    
  map = new google.maps.Map(
      document.getElementById('map-canvas'), map_options
  );

  map_marker_mov = new google.maps.Marker({
      /* ... Nastavenie pre ukazovate¾ pozície */
  });
  
  map_bns = new google.maps.LatLngBounds();
  <?php echo $bounds; ?>//Body tréningu cez ktoré sa mapa centruje
      
  map.mapTypes.set('map_style', style);
  map.setMapTypeId('map_style');        
  map.fitBounds(map_bns); // Vycentrovanie mapy   
  route_path.setMap(map); // Vykreslenie krivky
}

function map_selection(dt){
  
  for(var i = 0; i < dt.length; i++){
      selection_coordinates.push(
	  new google.maps.LatLng( dt[i].position_lat, dt[i].position_long )
      );
      selection_bounds.extend(
	  new google.maps.LatLng( dt[i].position_lat, dt[i].position_long )
      );
  }
  
  /* Reset predchádzajúceho zobrazenia */
  selection_path.setMap(null); 
  
  selection_path = new google.maps.Polyline({
      path: selection_coordinates,
      geodesic: true,
      strokeColor: '#9933cc',
  });
	  
  map.fitBounds(selection_bounds);
  selection_path.setMap(map);
}

function map_reset(){
  map.fitBounds(map_bns);
  selection_path.setMap(null);
}

google.maps.event.addDomListener(window, 'load', map_initialize);
</script>
\end{Verbatim}

\begin{figure}[H]
\centering
\includegraphics[scale=0.55]{images/inhillz_map.png}
\caption{Zobrazenie mapy v detailnom náh¾ade tréningu}
\label{fig:inhillz_map}
\end{figure}

Ïa¾šia èas programového kódu v tomto náh¾ade sa postará o vykreslenie grafu. Štandard HTML5 umoòuje do HTML kódu vklada SVG grafiku. Na zobrazenie priebehu celého tréningu pouijeme kninicu \emph{D3.js}. Kninica u¾ahèuje prácu s jednotlivımi elementami SVG, nako¾ko s nimi pracuje ako s objektami, ktoré majú vlastné metódy. Programovı kód vykres¾ujúci kompletnı graf s priebehom tréningu je pomerne rozsiahly, preto uvedieme len najdôleitejšie èasti.

\begin{Verbatim}[baselinestretch=0.75,numbers=left]
var chart_def = {<?php echo $chart_def; ?>};
    
var charts_count, i;
charts_count = i = Object.keys(chart_def).length;
    
var root = d3.select("#chart-canvas").append("svg")
	.attr("width", WIDTH )
	.attr("height", HEIGHT * i + MARGINS.top + MARGINS.bottom);

chart_draw(chart_data);
\end{Verbatim}
Premennú \emph{\$chart\_def} inicializujeme ešte v PHP, obsahuje definície velièín, ktorá sa majú zobrazi, tj. ku ktorım existujú dáta. Táto premenná obsahuje aj jednotky pre jednotlivé velièiny a poèet desatinnıch miest pri zobrazení. Riadok 6 zabezpeèí vloenie elementu \emph{$<$svg$>$} do HTML s fixnou vıškou a šírkou. O vykreslenie sa bude stara funkcia \emph{chart\_draw()}.

\begin{Verbatim}[baselinestretch=0.75]
function chart_draw(chart_data){

  /* X rozsah pod¾a celkovej vzdialenosti*/
  x_range = d3.scale.linear()
	  .range([MARGINS.left, WIDTH-MARGINS.right])
	  .domain([
	      d3.min(chart_data, function(d) {return d.distance;}), 
	      d3.max(chart_data, function(d) {return d.distance;})
	  ]);
	  
  //** Inicializacia funkcii
  for(var key in chart_def){
    
    /* ... Definovanie funkcií pre získanie maxima, minima a priemeru*/
    min[key], max[key], avg[key];

    /* Y rozsah pod¾a maxima a minima */
    y_range[key] = d3.scale.linear()
		.range([HEIGHT*i, HEIGHT*(i-1)])
		.domain(
		    [min[key] - 0.05 * min[key], max[key] + 0.05 * max[key]]
		);

    /* Funkcia pre vykreslenie priebehu */
    var draw_fn = d3.svg.line()
		.x(function(d) {return x_range(d.distance);})
		.y(function(d) {
		    return 
			y_range[key](d[key]) || y_range[key](min[key]);
		});

    chart_def[key].draw_fn = draw_fn;
    chart_def[key].x_range = x_range;
    chart_def[key].y_range = y_range[key];
    i--;
    
    //** Vykreslenie krivky
    svg.append('svg:path')
	.attr('d', chart_def[key].draw_fn(chart_data))
	.attr("class","datapath " + key)
	.attr("transform", "translate(" +(-MARGINS.left)+ ",0)");
  }
\end{Verbatim}

Vykres¾ovanie osí grafu nebudeme rozvádza dopodrobna. Graf disponuje interaktivitou. Po prechode myšou na konkrétnu pozíciu sa ved¾a grafu zobrazia hodnoty pre danı body a na mape sa zobrazí ukazovate¾ pozície. Kliknutím na graf a ahaním je moné vybra èas tréningu. Graf sa priblíi a na mape sa zvırazní vybraná èas rozdielnou farbou. Viï nasledujúci obrázok.

\begin{figure}[H]
\centering
\includegraphics[scale=0.65]{images/inhillz_selection.png}
\caption{Zvıraznenie vıberu pred priblíením konkrétnej èasti tréningu}
\end{figure}

\subsection{Porovnanie vısledkov}
Záver tejto kapitoly venujeme porovnaniu odhadnutıch hodnôt s hodnotami, ktoré boli reálne zmerané meraèom vıkonu. Vısledky, ktoré prezentujeme, sú na základe dát, získanıch v období september 2014 a máj 2016 tromi rôznymi športovcami a tromi rozdielnımi meraèmi vıkonu. Jedná sa o stúpania v rôznych nadmorskıch vıškach, od 0 do 1200 m n.m. v rôznych teplotnıch podmienkach, od 0 do 35°C a s rôznym priemernım sklonom, od 4 do 12\%. \\\\

1. meranie \textbf{Kaèín} (48.1903622, 17.0818403) dåka 2.9km, prevıšenie 98m, priemerné stúpanie 3\%, èas 8:45, teplota 28°C, 232~m~n.m.
2. meranie -- -- teplota 18°C
3. meranie \textbf{Pekná cesta} (48.2014473, 17.1273581) dåka 2.0km, prevıšenie 167m, priemerné stúpanie 8\%, èas 9:00, teplota 22°C, 222~m~n.m.
4. meranie \textbf{Stúpanie na Biely Krí} (48.2285839, 17.1407578), dåka 2.4km, prevıšenie 150m, priemerné stúpanie 6\%, èas 10:25, teplota 18°C, 163~m~n.m.
5. meranie \textbf{Zámok Náchod} (50.4227016, 16.1647466), dåka 0.5 km, prevıšenie 60 m, priemerné stúpanie 11.0\%, èas 1:51, teplota 12°C, 341~m~n.m.
6. meranie -- --
7. meranie -- -- 

\begin{figure}[H]
\centering
\includegraphics[scale=0.65]{images/strava_comparsion_sample02.png}
\caption{Porovanie aproximácie vıkonu - úsek è.1 - meranie è.2}
\end{figure}

\newpage
\section{Záver}

\newpage
\lhead{}%clear left side header, from this point to the end of the document
  \begin{thebibliography}{99}
  
  \bibitem{machine_learning}
  MARSLAND, S.: \emph{Machine Learning: An Algorithmic Perspective}. Chapman and Hall/CRC, 2009. 406s. ISBN 978-1420067187
  
  \bibitem{efficient_backprop}
  MONTAVON, G. - ORR, G. - MÜLLER, K. L.: \emph{Neural Networks: Tricks of the Trade}, 2. vydanie. Berlin: Springer-Verlag, 2012. 769s. ISBN 978-3-642-35288-1
  
  \bibitem{ill_conditioning}
  ORR, G. - SCHRAUDOLPH, N. - CUMMINS, F.: \emph{Preconditioning the Network}. [cit. 27. 10. 2015]. Dostupné na World Wide Web: $<$https://www.willamette.edu/~gorr/classes/cs449/precond.html$>$
  
  \bibitem{kontrolovany_trening}
  DÍVALD, L.: \emph{Kontrolovanı tréning}. Bratislava: Laurenc Dívald, 2009. 116s. ISBN 978-80-970358-1-5
  
  \bibitem{physiology_of_sport}
  KENNEY, W. L. - WILMORE, J. H. - COSTILL, D. L.: \emph{Physiology of Sport and Exercise}, 5. vydanie. Champaign: Human Kinetics, 2011. 640s. ISBN: 860-1401254188 
      
  \bibitem{encyklopedie_fyziky}
  REICHL, J. - VŠETIÈKA, M.: \emph{Encyklopedie fyziky - Valivı odpor}. [cit. 25. 4. 2015]. Dostupné na World Wide Web: $<$http://fyzika.jreichl.com/main.article/view/37-valivy-odpor$>$
  
  \bibitem{obecna_fyzika}
  HALLIDAY, D. - RESNICK, R. - WALKER, J.: \emph{Fyzika: vysokoškolská uèebnice obecné fyziky}. Brno: Vysoké uèení technické, 2000. 1278s. ISBN 80-214-1868-0

  \bibitem{bicycle_science}
  WILSON, D. G.: \emph{Bicycling Science}, 3. vydanie. Cambridge: The MIT Press, 2004. 485s. ISBN: 978-0262731546
  
  \bibitem{cyclingweekly_power}
  CYCLING-WEEKLY: \emph{Power meters: Everything you need to know}. [cit. 15. 4. 2015]. Dostupné na World Wide Web: $<$http://www.cyclingweekly.co.uk/news/power-meters-everything-you-need-to-know-35563$>$
   
  \bibitem{handbook_rolling_resistance}
  CLARK, S. K. - DODGE, R. N.: \emph{A Handbook for the Rolling Resistance of Pneumatic Tires}. Michigan: University of Michigan, 1979. 156s. ASIN: B0006XMSXI
     
  \bibitem{roller_data}
  BIKETECH-REVIEW: \emph{Roller Data}. [cit. 25. 4. 2015]. Dostupné na World Wide Web: $<$http://www.biketechreview.com/tires/rolling-resistance/475-roller-data$>$
  
  \bibitem{schwalbe}
  SCHWALBE: \emph{Rolling Resistance}. [cit. 14. 4. 2015]. Dostupné na World Wide Web: $<$http://www.schwalbetires.com/tech\_info/rolling\_resistance$>$
  
  \bibitem{standard_atmosphere}
  ISO 2533:1975 : \emph{Standard Atmosphere} - International Organization for Standardization
  
  \bibitem{drag_equation}
  NASA: \emph{The Drag Equation}. [cit. 16. 4. 2015]. Dostupné na World Wide Web: $<$https://www.grc.nasa.gov/www/k-12/airplane/drageq.html$>$
  
  \bibitem{cycling_power_lab}
  CYCLING POWER LAB: \emph{Cycling Aerodynamics \& CdA - A Primer}. [cit. 20. 10. 2015]. Dostupné na World Wide Web: $<$http://www.cyclingpowerlab.com/CyclingAerodynamics.aspx$>$
  
  \bibitem{sae_test}
  SAE J2452:1999 : \emph{Stepwise Coastdown Methodology for Measuring Tire Rolling Resistance} - Society of Automotive Engineers
  
  \bibitem{thisisant}
  THIS IS ANT: \emph{Developer}. [cit. 20. 12. 2014]. Dostupné na World Wide Web: $<$http://www.thisisant.com/developer$>$
    
  \bibitem{strava}
  STRAVA: \emph{About}. [cit. 10. 3. 2015]. Dostupné na World Wide Web: $<$https://www.strava.com/about$>$
  
  \bibitem{bikecalculator}
  BIKECALCULATOR: \emph{How to use}. [cit. 10. 3. 2015]. Dostupné na World Wide Web: $<$http://bikecalculator.com/how.html$>$

  \bibitem{bootstrap}
  BOOTSTRAP: \emph{Getting started}. [cit. 20. 12. 2014]. Dostupné na World Wide Web: $<$http://getbootstrap.com/getting-started/$>$
  
  \bibitem{d3js}
  MBOSTOCK: \emph{D3}. [cit. 20. 12. 2014]. Dostupné na World Wide Web: $<$https://github.com/mbostock/d3$>$
\end{thebibliography}

\newpage
\section*{Obsah CD nosièa}
\noindent Obsah priloeného CD nosièa je nasledovnı:
\begin{itemize}
  \item v prieèinku \emph{dokument} sa nachádza text diplomovej práce vo formáte PDF
  \item v prieèinku \emph{aplikácia} sú zdrojové súbory vıslednej funkènej aplikácie, a~tie skript pre vytvorenie tabuliek v databáze
  \item v prieèinku \emph{dokumentácia} je dokumentácia zdrojového kódu vo formáte HTML obsahujúca popis jednotlivıch tried a ich metód
\end{itemize}
\end{document}
